/*!
 * jQuery TinyValidate plugin v1.4
 *
 * Date: Wed Mar 09 14:37:21 2011 EST
 * Requires: jQuery v1.3+
 *
 * Copyright 2010, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses (just like jQuery):
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * A (relatively) tiny validation plugin
 *
 *
*/
(function(a){function x(m){for(var n in m)if(m.hasOwnProperty(n))return false;return true}function y(){window.console&&window.console.log&&console.log.apply(console,arguments)}function z(m,n){return m.replace(/\{([^\|]+)\|([^}]+)\}/g,function(o,l,g){return n*1==1?l:g})}a.tinyvalidate={version:"1.4",callCounter:-1,maxnum:0,rules:{}};var p={};p.inputs={};p.containers={};a.fn.tinyvalidate=function(m){a.tinyvalidate.callCounter++;var n=a.tinyvalidate.callCounter?"_"+a.tinyvalidate.callCounter:"",o=a.tinyvalidate.rules;
if(x(o))return y("you must have at least one rule. see jquery.tinyvalidate.rules.js","alert");return this.each(function(l){var g=a(this),i=a([]);n+=l?"-"+l:"";var k=a.extend(true,{},a.fn.tinyvalidate.defaults,m||{},a.metadata?g.metadata():a.meta?g.data():{}),t=[],q=0,j=k.inline;if(m=="removeErrors"){a.each(o,function(b,c){a("."+c.ruleClass,g).each(function(){i=i.add(a(this))})});i.removeData("error").trigger("removeNotice").trigger("toggleErrorClass");g.trigger("hideSummary");return this}if(k.summary){var f=
k.summary,r=a(f.wrapper).hide();a(f.insertTo=="form"?g[0]:f.insertTo)[f.insertType](r);if(f.lineItems)var s=f.lineItems.wrapper.match(/[^>]+>/g),A=s[1]+s[0],u=f.lineItems.errorElement?f.lineItems.errorElement.match(/[^>]+>/g):["",""]}a.each(o,function(b,c){var e="."+c.ruleClass;g.find(e).each(function(){var d;var h=this.nodeName;if(/(input|textarea|select)/i.test(h))d="inputs";else if(/(div|fieldset|p)/i.test(h))d="containers";d=d||"inputs";h=a(this);var v=h.data("rule")||[];if(!(this.nodeName===
"DIV"&&h.has(e))){v.push(o[b]);h.data("rule",v).data("ruleName",b).data("elementType",d);i=i.add(h);j&&h.data("insertion",p[d][j.insertType])}})});if(j){j.errorElement&&i.bind("addNotice",function(b,c){var e=a(this),d=a.isFunction(e.data("rule")[c].text)?e.data("rule")[c].text.call(this):e.data("rule")[c].text,h=a(j.errorElement);h.html(d);h[a(this).data("insertion")](this).hide();h[j.errorAnimate.effect](j.errorAnimate.speed);e.bind("removeNotice",function(){h.remove()})});i.bind("toggleErrorClass",
function(){var b=a(this),c=b.find('input[type="checkbox"], input[type="radio"]').length?b:b.closest(j.containerTag);b.data("error")?c.addClass(j.containerErrorClass):c.removeClass(j.containerErrorClass)})}if(f){g.bind("displaySummary",function(b,c){r.hide();if(c){var e=f.preMessage.replace(/\{num\}/g,c);e=z(e,c);e=f.lineItems?e+s[0]+t.join(A)+s[1]+f.postMessage:e+f.postMessage;r.html(e)[f.messageAnimate.effect](f.messageAnimate.speed)}});g.bind("hideSummary",function(){r.hide()});f.lineItems&&g.bind("lineItemBuilder",
function(b,c,e){b=a(c);var d=a("<div></div>").html(b.data("elementType")=="containers"?b.children(":first").html():b.prev().clone().html());d.children().remove();d=d.text().replace(/[\*:\s]+$/,"");e=a.isFunction(e.text)?e.text.call(this):e.text;if(f.lineItems.linkify)d='<a href="#'+(b.data("elementType")=="containers"?b.find("input")[0].id:c.id)+'">'+d+"</a>";t.push(d+" "+u[0]+e+u[1])})}i.bind("validate",function(){var b=a(this).trigger("removeNotice"),c=b.data("rule"),e=c.length;b.removeData("error");
for(var d=0;d<e;d++){c[d].elem&&c[d].elem(b);var h=c[d].check=="element"?b:b.val();if(!c[d].rule(h)&&!b.is(":hidden"))if(!(b.is(".required")&&c[d].ruleClass!="required"&&!b.val())){b.data("error","true").trigger("addNotice",[d]);g.trigger("lineItemBuilder",[this,c[d]]);q++}}b.trigger("toggleErrorClass")});g.bind("submit.tv",function(){q=0;t=[];i.trigger("validate");g.trigger("displaySummary",[q]);if(q)return false;else if(k.submitOverride){g.tinyvalidate("removeErrors");k.submitOverride.call(g[0],
k);return false}});if(k.otherEvents){if(typeof k.otherEvents=="string")var w=k.otherEvents.split(/\s*,\s*/);for(l=w.length-1;l>=0;l--)i.bind(w[l]+".tv",function(b){b.type=="click"&&!/^(?:radio|checkbox)$/i.test(b.target.type)||a(this).trigger("validate")})}})};a.fn.tinyvalidate.defaults={otherEvents:"blur",submitOverride:null};a.fn.tinyvalidate.defaults.inline={insertType:"after",errorElement:'<div class="error-message"></div>',errorAnimate:{effect:"fadeIn",speed:400},containerTag:"div",containerErrorClass:"error"};
a.fn.tinyvalidate.defaults.summary={insertTo:"form",insertType:"append",wrapper:'<div class="error-summary"></div>',preMessage:"Please review the {num} highlighted {field|fields} and try again.<ul>",postMessage:"</ul>",messageAnimate:{effect:"fadeIn",speed:400},lineItems:{wrapper:"<li></li>",errorElement:'<span class="error-message"></span>',linkify:true}};a.extend(p.inputs,{append:"insertAfter",appendTo:"insertAfter",after:"insertAfter",insertAfter:"insertAfter",prepend:"insertBefore",prependTo:"insertBefore",
before:"insertBefore",insertBefore:"insertBefore"});a.extend(p.containers,{append:"appendTo",appendTo:"appendTo",after:"appendTo",insertAfter:"appendTo",prepend:"prependTo",prependTo:"prependTo",before:"insertBefore",insertBefore:"insertBefore"})})(jQuery);
